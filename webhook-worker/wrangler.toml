name = "webhook-ingestion"
main = "build/index.js"
compatibility_date = "2025-01-01"

[build]
command = "cargo install -q worker-build && worker-build --release"

[observability]
enabled = true

# D1 Database binding (same database as admin)
# NOTE: Migrations are handled by admin worker via Drizzle
# This worker only reads/writes to the database
[[d1_databases]]
binding = "DB"
database_name = "webhook-db"
database_id = "4b560545-0e26-4d08-9058-b72cebe26514" # Replace after creating D1 database

# KV namespace for webhook cache (shared with admin worker)
# Populated automatically by setup-kv.js script
[[kv_namespaces]]
binding = "WEBHOOK_CACHE"
id = "3bcb003437494c9cbea59a6a37bb9eec"

# Environment variables
[vars]
ENVIRONMENT = "production"

# Route configuration - webhook ingestion endpoint
# Commented out for local development - uncomment for production
# [[routes]]
# pattern = "*/w/*"
# zone_name = "example.com" # Replace with your domain

# Development environment
[env.dev]
name = "webhook-ingestion-dev"
vars = { ENVIRONMENT = "development" }

# Production environment
[env.production]
name = "webhook-ingestion-prod"
vars = { ENVIRONMENT = "production" }
